#!/usr/bin/env ruby

unless defined? JRUBY_VERSION
  raise "This application must be run under JRuby"
end

require 'optparse'

options = {:wags => true, :language => "Java"}
opt_parser = OptionParser.new do |opts|
  opts.banner = "Usage: magnetizer [options] file"

  opts.on("-l", "--language LANGUAGE", "Specify a language") do |language|
    options[:language] = language
  end

  opts.on("--json", "Print the JSON output") do
    options[:json] = true
  end

  opts.on("--[no-]wags", "Print the output as WAGS magnets") do |wags|
    options[:wags] = wags
  end

  opts.on("-v", "--[no-]verbose", "Run verbosely") do |v|
    options[:verbose] = v
  end

  opts.on_tail("-h", "--help", "Show this message") do
    puts opts
    exit
  end
end

opt_parser.parse!

file = ARGV.first

if file.nil? || file.empty? 
  puts "No file specified"
  puts opt_parser
  exit
end

puts "Running the magnetizer on #{file}"

$CLASSPATH << "java/bin/"

require "lib/magnetizer.rb"
magnetizer = Magnetizer.new(file, options[:language])
# magnetizer.show_gui_tree
if options[:wags]
  magnetizer.print_magnets
end

if options[:json]
  magnetizer.print_json
end

puts "After running"
